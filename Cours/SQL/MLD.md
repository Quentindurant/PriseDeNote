
users (id_users, username, mail, phone, role, #address )

human (id_human, firstname, lastname, birth_date, birth_place, email, phone, jobe_name, incomes, status, family_status, caf_number, visale_number, #address, #iban)

compagny (id_compagny, name, creation_date, creation_place, email, phone, equity_capital, type, ceo_name, siren, rcs_city, incomes, #address, #iban)

warrant (id_warrant, duration, deposit, #human, #company)

tenant (id_tenant, #human , #company , #address , #documents)

documents (id_documents, name, mimi_type, path, created_at, signed_at)

address (id_address, name, street, number, city, zip, country)

property (id_property, name, rent,, charges, taxes, insurance, area, room, type, accessibility, description, lot, dependencies, build_year, landlord, #energy_dpe, #energy_ges, #address, #default_iban)

energy (id_energy, type, valu, production_date)

iban (id_iban, name, owner, iban, bic, bank)

article (id_article, name, #article_content)

article_content (id_article_content, name, version_number, created_at, content)

rental_folder (id_rental_folder, landlord, #tenant, #property, #documents)

paiment (id_paiment, amount, month, year, payed_at, #property )


# MPD

(SGBD : POSTGRE)

CREATE TYPE role_user_type AS ENUM('admin','client');
CREATE TYPE human_status_type AS ENUM('salarié','étudiant','indépendant','alternant');
CREATE TYPE human_family_status_type AS ENUM('célibataire','couple','Marié','Divorcé','Veuf/Veuve');

CREATE TABLE address (
  id_address     integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name           varchar(100),
  street         varchar(150),
  number         varchar(10),
  city           varchar(100),
  zip            varchar(10),
  country        varchar(100)
);

CREATE TABLE users (
  id_users			integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  mail				char(50) NOT NULL,
  phone				integer NOT NULL,
  role				role_user_type DEFAULT 'client',
  FOREIGN KEY (address_id)
  	REFERENCES address (id_address)
);

CREATE TABLE human (
  id_human			integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  firstname			char(20) NOT NULL,
  lastname			char(40) NOT NULL,
  birth_date		DATE,
  birth_place		varchar(75),
  email				varchar(50) NOT NULL,
  phone				integer NOT NULL,
  job_name			varchar(75) NOT NULL,
  incomes			varchar(75),
  status 			human_status_type NOT NULL,
  family_status		human_family_status_type NOT NULL,
  caf_number		integer NOT NULL, 
  visale_number		integer NOT NULL,
  FOREIGN KEY (address_id)
  	REFERENCES address (id_address),
  FOREIGN KEY (iban_id)
  	REFERENCES iban (id_iban)
);

CREATE TABLE compagny (
  id_compagny		integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name				char(50),
  creation_date		DATE,
  creation_place	varchar(75),
  email				varchar(50),
  phone				integer,
  equity_capital	varchar(50),
  type_				varchar(50),
  ceo_name			varchar(20),
  siren				integer,
  rcs_city			varchar(45), 
  incomes			varchar(45),
  FOREIGN KEY (address_id)
  	REFERENCES address (id_address),
  FOREIGN KEY (iban_id)
  	REFERENCES iban (id_iban)
);

CREATE TABLE warrant (
  id_warrant		integer generated by default AS identity PRIMARY KEY,
  duration 			timestamp,
  deposit			text(100),
  FOREIGN KEY (human_id)
  	REFERENCES human (id_human),
  FOREIGN KEY (compagny_id)
  	REFERENCES compagny (id_compagny)
);

CREATE TABLE iban (
  id_iban        integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name           varchar(100),
  owner          varchar(100),
  iban           varchar(34) UNIQUE NOT NULL,
  bic            varchar(15),
  bank           varchar(100)
);

CREATE TABLE documents (
  id_documents   integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name           varchar(150) NOT NULL,
  mime_type      varchar(120),
  path           text,
  created_at     timestamp,
  signed_at      timestamp
);

CREATE TABLE article_content (
  id_article_content integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name               varchar(150),
  version_number     varchar(20),
  created_at         date,
  content            text
);

CREATE TABLE article (
  id_article     integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name           varchar(150),
  article_content_id integer,
  FOREIGN KEY (article_content_id)
    REFERENCES article_content (id_article_content)
);

CREATE TABLE article_document (
  id_article_document integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  article_id     integer NOT NULL,
  document_id    integer NOT NULL,
  UNIQUE (article_id, document_id),
  FOREIGN KEY (article_id)  REFERENCES article(id_article),
  FOREIGN KEY (document_id) REFERENCES documents(id_documents)
);


CREATE TABLE energy (
  id_energy      integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  type_          varchar(10),    -- 'DPE' ou 'GES'
  value          varchar(5),     -- A -> G
  production_date date
);

CREATE TABLE landlord (
  id_landlord    integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name           varchar(100),
  owner          varchar(100),
  iban           varchar(34),
  bic            varchar(15),
  bank           varchar(100)
);

CREATE TABLE property (
  id_property      integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name             varchar(150),
  rent             numeric(12,2),
  charges          numeric(12,2),
  taxes            numeric(12,2),
  insurance        varchar(100),
  area             numeric(10,2),
  room             integer,
  type_            varchar(50),
  accessibility    boolean,
  description      text,
  energy_dpe_id    integer,
  energy_ges_id    integer,
  address_id       integer,
  lot              varchar(50),
  dependencies     text,
  build_year       integer,
  default_iban     integer,
  default_landlord integer,
  FOREIGN KEY (energy_dpe_id)    REFERENCES energy(id_energy),
  FOREIGN KEY (energy_ges_id)    REFERENCES energy(id_energy),
  FOREIGN KEY (address_id)       REFERENCES address(id_address),
  FOREIGN KEY (default_iban)     REFERENCES iban(id_iban),
  FOREIGN KEY (default_landlord) REFERENCES landlord(id_landlord)
);


CREATE TABLE property_document (
  id_property_document integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  property_id    integer NOT NULL,
  document_id    integer NOT NULL,
  UNIQUE (property_id, document_id),
  FOREIGN KEY (property_id) REFERENCES property(id_property),
  FOREIGN KEY (document_id) REFERENCES documents(id_documents)
);

CREATE TABLE tenant (
  id_tenant      integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  human_id       integer,
  compagny_id    integer,
  address_id     integer,
  bill_address   varchar(150),
  documents_id   integer,
  FOREIGN KEY (human_id)     REFERENCES human(id_human),
  FOREIGN KEY (compagny_id)  REFERENCES compagny(id_compagny),
  FOREIGN KEY (address_id)   REFERENCES address(id_address),
  FOREIGN KEY (documents_id) REFERENCES documents(id_documents),
  CHECK (
    (human_id IS NOT NULL AND compagny_id IS NULL)
    OR
    (human_id IS NULL AND compagny_id IS NOT NULL)
  )
);

CREATE TABLE rental_folder (
  id_rental_folder integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  tenant_id        integer NOT NULL,
  property_id      integer NOT NULL,
  documents_id     integer,
  FOREIGN KEY (tenant_id)    REFERENCES tenant(id_tenant),
  FOREIGN KEY (property_id)  REFERENCES property(id_property),
  FOREIGN KEY (documents_id) REFERENCES documents(id_documents)
);

CREATE TABLE rental_folder_document (
  id_rfd          integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  rental_folder_id integer NOT NULL,
  document_id      integer NOT NULL,
  UNIQUE (rental_folder_id, document_id),
  FOREIGN KEY (rental_folder_id) REFERENCES rental_folder(id_rental_folder),
  FOREIGN KEY (document_id)      REFERENCES documents(id_documents)
);

CREATE TABLE payment (
  id_payment       integer GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  rental_folder_id integer NOT NULL,
  amount           numeric(10,2) NOT NULL,
  month            integer,
  year             integer,
  payed_at         date,
  FOREIGN KEY (rental_folder_id) REFERENCES rental_folder(id_rental_folder)
);
